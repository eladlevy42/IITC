<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="main">
      <div class="boardWrapper">
        <h1>CARS MEMORY GAME</h1>
        <div class="top">
          <label id="mistakes">MISTAKES: 0</label
          ><label id="win" style="display: none">You Win!</label>
          <label id="moves">MOVES: 0</label>
        </div>
        <div id="board"></div>
        <button
          class="reset"
          id="NGbtn"
          style="display: none"
          onclick="reset()"
        >
          NEW GAME
        </button>
        <label id="lblSize">WHAT SIZE OF BOARD DO YOU WANNA PLAY?</label>
        <div id="boardSizeWrapper">
          <button class="boardSizeBtn" id="bSize2" onclick="createBoard(2)">
            2X2
          </button>
          <button class="boardSizeBtn" id="bSize4" onclick="createBoard(4)">
            4X4
          </button>

          <button class="boardSizeBtn" id="bSize6" onclick="createBoard(6)">
            6X6
          </button>
        </div>
        <h6>by Elad Levy</h6>
      </div>
    </div>

    <script>
      let objArr;
      let opnCardCount = 0;
      let opnCardId1;
      let opnCardId2;
      let mistakes = 0;
      let moves = 0;
      let score = 0;
      let sizeOfBoard = 4;
      function createObjArr() {
        let rndArr = [];
        let rndPicArr = [];
        let rndCount = 0;
        let rnd1 = 0;
        let rnd2 = 0;
        let rndPicId = 0;
        let funResultArr = [];
        let i = 1;
        for (let i = 0; i < sizeOfBoard / 2; i++) {
          //loop that adds a number of the picture in random order to an array
          while (true) {
            rndPicId = Math.floor(Math.random(1) * (sizeOfBoard / 2)) + 1;
            if (rndPicArr.find((element) => element == rndPicId) == undefined) {
              rndPicArr.push(rndPicId);
              break;
            }
          }
          while (true) {
            rnd1 = Math.floor(Math.random(1) * sizeOfBoard) + 1;
            if (rndArr.find((j) => j == rnd1) == undefined) {
              rndArr.push(rnd1);
              break;
            }
          }
          while (true) {
            rnd2 = Math.floor(Math.random(1) * sizeOfBoard) + 1;
            if (rndArr.find((i) => i == rnd2) == undefined) {
              rndArr.push(rnd2);
              break;
            }
          }
          funResultArr.push({ id1: rnd1, id2: rnd2, picId: rndPicId });
        }
        console.log(funResultArr);
        return funResultArr;
      }

      function givePicToId() {
        for (let i of objArr) {
          //i = { id1: rnd1, id2: rnd2, picId: rndPicId }
          document.querySelector(
            `#card${i.id1}`
          ).innerHTML += `<img id = "p${i.id1}" class= "card" src="/pictures/${i.picId}.jpg">`;
          document.querySelector(
            `#card${i.id2}`
          ).innerHTML += `<img id = "p${i.id2}" class= "card" src="/pictures/${i.picId}.jpg">`;
          document.querySelector(`#p${i.id1}`).style.display = "none";
          document.querySelector(`#p${i.id2}`).style.display = "none";
        }
      }
      function updateMoveMis() {
        //updates the labels
        document.querySelector("#moves").textContent = "Moves: " + moves;
        document.querySelector("#mistakes").textContent =
          "Mistakes: " + mistakes;
      }
      function justAPeek() {
        // a function that shows the cards for 3 seconds and then hides them
        for (let i = 1; i <= sizeOfBoard; i++) {
          //reveal the cards
          document.querySelector(`#p${i}`).style.display = "block";
          document.querySelector(`#s${i}`).style.display = "none";
        }
        setTimeout(hideCards, 3000); //hide the cars after 3 seconds
      }
      function hideCards() {
        for (let i = 1; i <= sizeOfBoard; i++) {
          //reveal the blocks
          document.querySelector(`#p${i}`).style.display = "none";
          document.querySelector(`#s${i}`).style.display = "block";
        }
      }
      function revealPic(pictureId) {
        opnCardCount++;
        if (opnCardCount == 1) {
          //if only one card open:
          opnCardId1 = pictureId;

          document.querySelector(`#s${pictureId}`).style.display = "none";
          document.querySelector(`#p${pictureId}`).style.display = "block";
        } else if (opnCardCount == 2) {
          opnCardId2 = pictureId;
          if (opnCardId1 == opnCardId2) {
            //won't happen
          }
          document.querySelector(`#s${opnCardId2}`).style.display = "none";
          document.querySelector(`#p${opnCardId2}`).style.display = "block";
          ///check both cards are the same pic
          moves++;
          if (!checkSamePic()) {
            disableAllButtons();
            setTimeout(flipSquares, 1000); //flip the squares but wait 1 seconds
            mistakes++;
          } else {
            score++;
            if (score == sizeOfBoard / 2) {
              document.querySelector("#win").style.display = "block";
            }
          }

          updateMoveMis();
          opnCardCount = 0;
        }
      }
      function createBoard(num) {
        opnCardCount = 0;
        opnCardId1;
        opnCardId2;
        mistakes = 0;
        moves = 0;
        score = 0;
        document.querySelector("#board").style.gridTemplateColumns =
          "repeat(" + num + ", 90px)";
        document.querySelector("#lblSize").style.display = "none";
        document.querySelector("#bSize6").style.display = "none";
        document.querySelector("#bSize2").style.display = "none";
        document.querySelector("#bSize4").style.display = "none";
        document.querySelector("#NGbtn").style.display = "block";
        num *= num;
        sizeOfBoard = num;
        objArr = createObjArr(); // an arrey of 2 square ids and 1 picture id
        for (let i = 1; i <= sizeOfBoard; i++) {
          document.querySelector(
            "#board"
          ).innerHTML += `<div class="card" id="card${i}">
            <button class="square" id="s${i}" onclick="revealPic(${i})"></button>
          </div>`;
        }
        givePicToId();
        justAPeek();
      }

      function reset() {
        document.querySelector("#board").innerHTML = "";
        document.querySelector("#win").style.display = "none";
        document.querySelector("#board").style.display = "grid";
        document.querySelector("#board").style.gridTemplateColumns = "";
        document.querySelector("#lblSize").style.display = "block";
        document.querySelector("#bSize6").style.display = "block";
        document.querySelector("#bSize2").style.display = "block";
        document.querySelector("#bSize4").style.display = "block";
        document.querySelector("#NGbtn").style.display = "none";
        updateMoveMis();
      }
      function disableAllButtons() {
        let sqLst = document.querySelectorAll(".square");
        for (let i of sqLst) {
          i.onclick = "";
        }
      }
      function enableAllButtons() {
        let sqLst = document.querySelectorAll(".square");
        for (let i = 1; i <= sqLst.length; i++) {
          sqLst[i - 1].onclick = function () {
            revealPic(i);
          };
        }
      }

      function flipSquares() {
        document.querySelector(`#s${opnCardId1}`).style.display = "block";
        document.querySelector(`#p${opnCardId1}`).style.display = "none";
        document.querySelector(`#s${opnCardId2}`).style.display = "block";
        document.querySelector(`#p${opnCardId2}`).style.display = "none";
        enableAllButtons();
        // enableAllButtons();
      }
      function checkSamePic() {
        for (let i of objArr) {
          if (
            (i.id1 == opnCardId1 && i.id2 == opnCardId2) ||
            (i.id1 == opnCardId2 && i.id2 == opnCardId1)
          ) {
            return true;
          }
        }
        return false;
      }
    </script>
  </body>
</html>
